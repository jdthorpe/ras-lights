"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[702],{79975:function(e,n,t){t.r(n),t.d(n,{default:function(){return ae}});var r,i,s,a,c,o,u,l,d=t(47476),h=t(74812),f=t(18487),p=t(41004),x=t(32951),g=t.n(x),m=t(48934),b=t(71876),y=t(23408),v=t(34878),j=t(67872),S=t(86776),k=t(54329),Z=t(22340),w=t(63660),C=t(72905),P=t(1430),R=t(9812),_=t(20742),T=t(38639),W={main:{maxWidth:450}},B=C.ZP.div(r||(r=(0,d.Z)(["\n    display: flex;\n    flex-direction: row;\n"]))),I=C.ZP.table(i||(i=(0,d.Z)(["\n    border-collapse: collapse;\n    tr:nth-child(even) {background: #DDD};\n    tr:nth-child(odd) {background: #FFF};\n"]))),G=C.ZP.th(s||(s=(0,d.Z)(["\n    border: 1px solid #999;\n    padding: 0.5rem;\n    text-align: left;\n"]))),L=C.ZP.td(a||(a=(0,d.Z)(["\n    border: 1px solid #999;\n    padding: 0.5rem;\n    text-align: left;\n"]))),D={type:m.i.normal,title:"Are you sure?",closeButtonAriaLabel:"Close",subText:"Are you sure you want to delete this library?"},E="Required field",M=function(e){var n=e.update,t=(0,h.useState)(!0),r=(0,p.Z)(t,2),i=r[0],s=r[1],a=(0,h.useState)(),c=(0,p.Z)(a,2),o=c[0],u=c[1],l=(0,h.useState)(),d=(0,p.Z)(l,2),x=d[0],m=d[1],b=(0,h.useState)(),y=(0,p.Z)(b,2),v=y[0],j=y[1],k=(0,h.useState)(),Z=(0,p.Z)(k,2),C=Z[0],_=Z[1],W=(0,h.useState)(),B=(0,p.Z)(W,2),I=B[0],G=B[1],D=(0,h.useCallback)((function(e,n){j(n),s(!0),C===E&&n&&n.length&&_(void 0)}),[j,C]),M=(0,h.useCallback)((function(e,n){u(n),s(!0),x===E&&n&&n.length&&m(void 0)}),[x]),K=(0,h.useCallback)((0,f.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:if(v||_(E),o||m(E),v&&o){e.next=6;break}return e.abrupt("return");case 6:return s(!1),e.prev=7,e.next=10,w.r$({type:"LIBRARY",name:o,path:v});case 10:G(void 0),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),G(e.t0.message||"Something went wrong");case 16:n();case 17:case"end":return e.stop()}}),e,null,[[7,13]])}))),[o,v,i,s,n]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("tr",{children:[(0,T.jsx)(L,{children:(0,T.jsx)(S.n,{onChange:M,errorMessage:x})}),(0,T.jsx)(L,{children:(0,T.jsx)(S.n,{onChange:D,errorMessage:C})}),(0,T.jsx)(L,{children:(0,T.jsx)(P.G,{style:{margin:"0 7px",color:i?"black":"grey"},icon:R.r8p,title:"Add",onClick:K})})]}),I&&(0,T.jsxs)("p",{style:{color:"red"},children:["Somethig went wrong while saving: ",I]})]})},K=function(e){var n=e.lib,t=e.update,r=e.set_error,i=(0,h.useState)(!0),s=(0,p.Z)(i,2),a=s[0],c=s[1],o=(0,_.k)(!0),u=(0,p.Z)(o,2),l=u[0],d=u[1].toggle;(0,h.useEffect)((function(){return function(){return c(!0)}}),[c,n]);var x=(0,h.useCallback)((0,f.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return c(!1),e.next=5,w.HG(n.name);case 5:t();case 6:case"end":return e.stop()}}),e)}))),[n,a,t]),m=(0,h.useCallback)((0,f.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/lib/reload/".concat(n.name));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),r(e.t0.message||"Something went wrong while reloading the library ".concat(n.name));case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),[r,n]);return(0,T.jsxs)("tr",{children:[(0,T.jsx)(L,{children:n.name}),(0,T.jsx)(L,{children:n.path}),(0,T.jsx)(L,{children:(0,T.jsxs)(B,{children:[(0,T.jsx)(P.G,{style:{margin:"0 7px",color:a?"black":"grey"},icon:R.tmN,title:"Reload",onClick:m}),(0,T.jsx)(P.G,{style:{margin:"0 7px",color:a?"black":"grey"},icon:R.I7k,title:"Delete",onClick:d})]})}),(0,T.jsx)(b.V,{hidden:l,onDismiss:d,dialogContentProps:D,modalProps:{isBlocking:!1,styles:W},children:(0,T.jsxs)(y.c,{children:[(0,T.jsx)(v.K,{onClick:function(){d(),x()},text:"Delete"}),(0,T.jsx)(j.a,{onClick:d,text:"Cancel"})]})})]})},F=function(){var e=(0,h.useState)(),n=(0,p.Z)(e,2),t=n[0],r=n[1],i=(0,h.useState)(),s=(0,p.Z)(i,2),a=s[0],c=s[1],o=function(){var e=(0,f.Z)(g().mark((function e(){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.wZ();case 2:n=e.sent,r(n.sort((function(e,n){return e.name<n.name?-1:1})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,h.useEffect)((function(){"undefined"===typeof t&&o()}),[t]),"undefined"===typeof t?(0,T.jsx)("div",{children:(0,T.jsx)(k.$,{label:"Loading Libraries...",size:Z.E.large})}):(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{children:"Library Folders"}),(0,T.jsxs)(I,{children:[(0,T.jsxs)("colgroup",{children:[(0,T.jsx)("col",{style:{minWidth:"6rem"}}),(0,T.jsx)("col",{style:{minWidth:"20rem"}}),(0,T.jsx)("col",{style:{width:"3rem"}})]}),(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)(G,{children:"Name"}),(0,T.jsx)(G,{children:"Path"}),(0,T.jsx)(G,{})]})}),(0,T.jsxs)("tbody",{children:[t.map((function(e,n){return(0,T.jsx)(K,{lib:e,update:o,set_error:c},n)})),(0,T.jsx)(M,{update:o})]})]}),a&&(0,T.jsx)("p",{style:{color:"red"},children:"error"})]})},O=t(78464),q=t(26494),A=t(26975),N=t(55977),z=t(62839),$=t(21322),H=t.n($),J=t(30099),U=t(96806),V=C.ZP.div(c||(c=(0,d.Z)(["\n    display: flex;\n    flex-direction: Row;\n    gap: 1rem;\n"]))),Y=C.ZP.div(o||(o=(0,d.Z)(["\n    display: flex;\n    flex-direction: Row;\n    border-radius: 5px;\n    gap: 1rem;\n    padding-left: 12px;\n    padding-right: 12px;\n"]))),Q=["PWM0","PWM1","PCM_DOUT","SPI0-MOSI"],X=function(e){var n=e.pins,t=e.channel,r=e.onChange,i=(0,h.useState)(t.brightness),s=(0,p.Z)(i,2),a=s[0],c=s[1],o=(0,h.useState)(t.count),u=(0,p.Z)(o,2),l=u[0],d=u[1],f=(0,h.useState)(t.gpio),x=(0,p.Z)(f,2),g=x[0],m=x[1],b=(0,h.useState)(t.type),y=(0,p.Z)(b,2),v=y[0],j=y[1],S=(0,h.useState)(t.invert),k=(0,p.Z)(S,2),Z=k[0],w=k[1],C=(0,h.useState)(t.reverse),P=(0,p.Z)(C,2),R=P[0],_=P[1];return(0,h.useEffect)((function(){r({brightness:a,count:l,gpio:g,type:v,invert:Z,reverse:R})}),[a,l,g,v,Z,R,r]),(0,h.useEffect)((function(){c(t.brightness),d(t.count),m(t.gpio),j(t.type)}),[t]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(q.L,{label:"GPIO",styles:{root:{minWidth:"5rem",maxWidth:"5rem"}},options:n.map((function(e){return{key:e,text:"".concat(e)}})),selectedKey:g,onChange:function(e,n,t){e&&n&&m(n.key)}}),(0,T.jsx)(J.M,{label:"Brightness",value:a,min:0,max:255,onChange:c}),(0,T.jsx)(J.M,{label:"Count",value:l,min:0,onChange:d}),(0,T.jsx)(A.Z,{label:"Invert",checked:Z,onChange:function(e,n){return"undefined"!==typeof n&&w(n)}}),(0,T.jsx)(A.Z,{label:"Reverse",checked:R,onChange:function(e,n){return"undefined"!==typeof n&&_(n)}}),(0,T.jsx)(q.L,{label:"Strip Type",styles:{root:{minWidth:"11rem",maxWidth:"11rem"}},options:ee.map((function(e){return{key:e,text:e}})),selectedKey:v,onChange:function(e,n,t){n&&j(n.key)}})]})},ee=["WS2811_STRIP_RGB","WS2811_STRIP_RBG","WS2811_STRIP_GBR","WS2811_STRIP_GRB","WS2811_STRIP_BRG","WS2811_STRIP_BGR","K6812_STRIP_RGBW","SK6812_STRIP_RBGW","SK6812_STRIP_GBRW","SK6812_STRIP_GRBW","SK6812_STRIP_BRGW","SK6812_STRIP_BGRW"],ne=[[12,18,40,52],[13,19,41,45,53],[21,31],[10,38]],te=function(){var e=(0,h.useState)(),n=(0,p.Z)(e,2),t=n[0],r=n[1],i=(0,h.useState)(!1),s=(0,p.Z)(i,2),a=s[0],c=s[1],o=(0,h.useState)(10),u=(0,p.Z)(o,2),l=u[0],d=u[1],x=(0,h.useState)(8e5),m=(0,p.Z)(x,2),b=m[0],y=m[1],j=(0,h.useState)([]),S=(0,p.Z)(j,2),k=S[0],Z=S[1];(0,h.useEffect)((function(){console.log("Driver mounting");var e=!1;return(0,f.Z)(g().mark((function n(){var t,i,s,a;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("/ras-lights/api/driver/");case 3:if(t=n.sent,!e){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,t.json();case 8:if(i=n.sent,!e){n.next=11;break}return n.abrupt("return");case 11:if(null!==i){n.next=16;break}return s={gpio:ne[0][0],count:1,brightness:255,type:ee[0],invert:!1,reverse:!1},r({frequency:8e5,dma:10,channels:[s]}),Z([s]),n.abrupt("return");case 16:r(i),y(i.frequency),i.channels&&i.channels.length?Z(i.channels):(a={gpio:ne[0][0],count:1,brightness:255,type:ee[0],invert:!1,reverse:!1},Z([a])),d(i.dma),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(0),console.log("dB driver error: ",n.t0);case 25:case"end":return n.stop()}}),n,null,[[0,22]])})))(),function(){e=!0}}),[]);var w=(0,h.useCallback)((function(e,n){Z([].concat((0,O.Z)(k.slice(0,n)),[e],(0,O.Z)(k.slice(n+1))))}),[k]);(0,h.useEffect)((function(){c(!H()(t,{frequency:b,dma:l,channels:k}))}),[t,b,l,k]);var C=(0,h.useCallback)((0,f.Z)(g().mark((function e(){var n,t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,t={frequency:b,dma:l,channels:k},e.next=4,fetch("/ras-lights/api/driver/",{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 4:if(!n){e.next=6;break}return e.abrupt("return");case 6:return r(t),e.abrupt("return",(function(){return n=!0}));case 8:case"end":return e.stop()}}),e)}))),[b,l,k]),P=(0,h.useCallback)((function(){var e={gpio:ne[k.length][0],count:1,brightness:255,type:ee[0],invert:!1,reverse:!1};Z([].concat((0,O.Z)(k),[e]))}),[k]),_=(0,h.useCallback)((function(){Z(k.slice(0,-1))}),[k]);return t?(0,T.jsxs)("div",{children:[(0,T.jsxs)(V,{style:{alignItems:"flex-end"},children:[(0,T.jsx)("h2",{children:"Driver Settings"}),(0,T.jsx)("p",{style:{color:"grey"},children:(0,T.jsxs)("a",{href:"https://github.com/dsyomichev/rpi-ws281x-led#driver-configuration",children:["See the ",(0,T.jsx)("span",{style:{fontFamily:"monospace"},children:"rpi-ws281x-led"})," library for details"]})})]}),(0,T.jsxs)(Y,{children:[(0,T.jsx)(J.M,{label:"Frequency",min:0,value:b,onChange:y}),(0,T.jsx)(J.M,{label:"dma",value:l,min:0,onChange:d}),(0,T.jsx)(v.K,{label:"Save",onClick:C,disabled:!a,style:{alignSelf:"flex-end",marginLeft:"auto"},children:"Save"})]}),(0,T.jsx)("h3",{style:{marginTop:"1.5rem"},children:"Light Strips"}),k&&k.map((function(e,n){return(0,T.jsxs)(Y,{style:{backgroundColor:n%2?"#dddddd":"none"},children:[(0,T.jsx)(X,{pins:ne[n],channel:e,onChange:function(e){return w(e,n)}}),(0,T.jsxs)("div",{children:[(0,T.jsx)(N._,{children:"Pin\xa0Mode"}),(0,T.jsx)("p",{children:Q[n]})]}),(0,T.jsx)("div",{style:{alignSelf:"center",marginLeft:"auto"},children:n===k.length-1&&n<3&&(0,T.jsx)(z.h,{onClick:P,title:"Add Strand",icon:R.r8p})}),(0,T.jsx)("div",{style:{alignSelf:"center"},children:n===k.length-1&&n>0&&(0,T.jsx)(z.h,{onClick:_,title:"Delete strand",icon:R.I7k})})]},n)}))]}):(0,T.jsx)(U.gb,{})},re=t(93639),ie=C.ZP.div(u||(u=(0,d.Z)(["\n    display: flex;\n    flex-direction: Column;\n    gap: 1rem;\n    margin: 1rem;\n    max-width: 1000px;\n"]))),se=C.ZP.div(l||(l=(0,d.Z)(["\n    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);\n    padding: 0 1rem 1rem;\n"]))),ae=function(){return(0,T.jsxs)(ie,{children:[(0,T.jsx)(se,{children:(0,T.jsx)(re.Z,{})}),(0,T.jsx)(se,{children:(0,T.jsx)(te,{})}),(0,T.jsx)(se,{style:{marginBottom:"2rem"},children:(0,T.jsx)(F,{})})]})}},63660:function(e,n,t){t.d(n,{wZ:function(){return a},r$:function(){return o},HG:function(){return l}});var r=t(18487),i=t(32951),s=t.n(i);function a(){return c.apply(this,arguments)}function c(){return(c=(0,r.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/ras-lights/api/lib/");case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(e){return u.apply(this,arguments)}function u(){return(u=(0,r.Z)(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/ras-lights/api/lib/",{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/ras-lights/api/lib/".concat(n),{method:"DELETE",cache:"no-cache"});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},62839:function(e,n,t){t.d(n,{h:function(){return l}});var r,i=t(25571),s=t(47476),a=(t(74812),t(72905)),c=t(1430),o=t(38639),u=a.ZP.div(r||(r=(0,s.Z)(["\n    width: 2rem;\n    height: 2rem;\n    font-size: 1.2rem;\n    border-radius: 2px;\n    background: grey;\n    padding-top: 0.4rem;\n    box-sizing: border-box;\n"]))),l=function(e){var n=e.icon,t=e.title,r=e.onClick,s=e.style,a=e.buttonStyle,l=e.iconStyle;return(0,o.jsx)(u,{onClick:r,style:(0,i.Z)((0,i.Z)({},s),a),children:(0,o.jsx)(c.G,{title:t,style:(0,i.Z)((0,i.Z)({margin:"auto",display:"block"},s),l),icon:n})})}},56714:function(e,n,t){t.d(n,{L:function(){return s}});var r=t(74812),i=t(3218),s=function(){var e=(0,i.B)({});return r.useEffect((function(){return function(){for(var n=0,t=Object.keys(e);n<t.length;n++){var r=t[n];clearTimeout(r)}}}),[e]),(0,i.B)({setTimeout:function(e){function n(n,t){return e.apply(this,arguments)}return n.toString=function(){return e.toString()},n}((function(n,t){var r=setTimeout(n,t);return e[r]=1,r})),clearTimeout:function(e){function n(n){return e.apply(this,arguments)}return n.toString=function(){return e.toString()},n}((function(n){delete e[n],clearTimeout(n)}))})}}}]);
//# sourceMappingURL=702.225c66bb.chunk.js.map